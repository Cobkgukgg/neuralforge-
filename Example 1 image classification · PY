"""
Example 1: Image Classification

Just a basic MNIST-style classifier. Nothing fancy, but it works.
"""

import numpy as np
import sys
sys.path.append('..')
from neuralforge import Architectures, TrainingConfig

def generate_mnist_like_data(n_samples=1000):
    """Generate some fake MNIST-style data for testing"""
    X = np.random.randn(n_samples, 784)  # 28x28 flattened
    y = np.random.randint(0, 10, n_samples)  # 10 classes
    y_onehot = np.eye(10)[y]
    
    return X / 255.0, y_onehot

def main():
    print("="*60)
    print("Example 1: Image Classification")
    print("="*60)
    
    # Make some data
    print("\n1. Generating synthetic MNIST-like data...")
    X_train, y_train = generate_mnist_like_data(5000)
    X_test, y_test = generate_mnist_like_data(1000)
    
    # Build the model
    print("\n2. Building MLP...")
    model = Architectures.mlp(
        input_dim=784,
        hidden_dims=[256, 128, 64],
        output_dim=10,
        activation="gelu"  # trying GELU instead of ReLU
    )
    
    model.compile(loss="categorical_crossentropy", optimizer="adam")
    model.summary()
    
    # Training settings
    config = TrainingConfig(
        learning_rate=0.001,
        batch_size=128,
        epochs=30,
        validation_split=0.2,
        early_stopping=True,
        patience=5
    )
    
    # Train it
    print("\n3. Training...")
    history = model.fit(X_train, y_train, config=config)
    
    # See how we did
    print("\n4. Evaluating...")
    results = model.evaluate(X_test, y_test)
    print(f"\nTest Loss: {results['loss']:.4f}")
    print(f"Test Accuracy: {results['accuracy']:.4f}")
    
    # Save for later
    model.save("mnist_classifier.pkl")
    
    return model, history

if __name__ == "__main__":
    model, history = main()
    print("\nDone!")
